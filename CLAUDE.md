# Awesome Mail - Flutter Email Client

## ğŸ“‹ **å°ˆæ¡ˆè¦æ ¼æ–‡ä»¶**

**é‡è¦**ï¼šæœ¬å°ˆæ¡ˆæ¡ç”¨å®Œæ•´çš„ Spec-Driven Development æ–¹æ³•ã€‚æ‰€æœ‰è©³ç´°çš„éœ€æ±‚ã€è¨­è¨ˆå’Œå¯¦ä½œè¨ˆåŠƒéƒ½åœ¨ä»¥ä¸‹è¦æ ¼æ–‡ä»¶ä¸­ï¼š

- **ğŸ“‹ æ–‡ä»¶ç›®éŒ„ **: [.kiro](.kiro) - æ‰€æœ‰éœ€è¦éµå®ˆçš„æ–‡ä»¶éƒ½åœ¨é€™å€‹ç›®éŒ„ä¸‹

**é–‹å§‹é–‹ç™¼å‰ï¼Œè«‹å‹™å¿…é–±è®€ä¸Šè¿°è¦æ ¼æ–‡ä»¶ä»¥äº†è§£å®Œæ•´çš„å°ˆæ¡ˆè¦æ±‚å’Œå¯¦ä½œè¨ˆåŠƒã€‚**

## ğŸ—ï¸ **å°ˆæ¡ˆçµæ§‹èˆ‡æ¨¡çµ„çµ„ç¹”**

### **Monorepo æ¶æ§‹**
- **Backend**: `awesome-mail/` (Cloudflare Workers TypeScript)
  - ç¨‹å¼ç¢¼ï¼š`src/`
  - æ¸¬è©¦ï¼š`tests/`
- **Flutter Client**: `awesome_mail_flutter/`
  - ç¨‹å¼ç¢¼ï¼š`lib/`
  - æ¸¬è©¦ï¼š`test/`, `integration_test/`
- **è¦æ ¼æ–‡ä»¶**: `.kiro/*` - åŒ…å« `requirements.md`, `design.md`, `tasks.md`

### **æ¨¡çµ„ä¿®æ”¹åŸå‰‡**
- ç·¨è¼¯å‰å‹™å¿…é–±è®€å°æ‡‰çš„è¦æ ¼æ–‡ä»¶ï¼Œç¢ºä¿ç¬¦åˆéœ€æ±‚
- å„ªå…ˆæ›´æ–°ç¾æœ‰æª”æ¡ˆï¼Œé è¨­ä¿ç•™å…¬é–‹ API
- åƒ…åœ¨è¦æ ¼æ˜ç¢ºè¦æ±‚æ™‚æ‰å»ºç«‹æ–°æ¨¡çµ„

## ğŸ”„ **é–‹ç™¼å·¥ä½œæµç¨‹èˆ‡è¦æ ¼éµå¾ª**

### **Spec-Driven TDD æµç¨‹**
1. **è®€å–è¦æ ¼**: å…ˆè®€å–æ‰€æœ‰çš„ `requirements.md`ã€`design.md` å’Œ `tasks.md`
2. **ç†è§£éœ€æ±‚**: ç¢ºèªè¦åŸ·è¡Œçš„ä»»å‹™å°æ‡‰å“ªäº›éœ€æ±‚ (Requirements)
3. **éµå¾ªè¨­è¨ˆ**: æŒ‰ç…§ `design.md` ä¸­çš„æ¶æ§‹å’Œçµ„ä»¶è¨­è¨ˆå¯¦ä½œ
4. **TDD é–‹ç™¼**: åš´æ ¼éµå¾ª Redâ†’Greenâ†’Refactor å¾ªç’°
5. **å°å‹æäº¤**: ä¿æŒå°è€Œé »ç¹çš„æäº¤
6. **å“è³ªæª¢æŸ¥**: å®Œæˆå¾ŒåŸ·è¡Œå®Œæ•´çš„å“è³ªæª¢æŸ¥æµç¨‹

### **å•é¡Œè§£æ±ºç­–ç•¥**
- åœ¨é™¤éŒ¯æ™‚ï¼Œåœ¨ç›¸é—œæµç¨‹åŠ ä¸Š log ä»¥å¹«åŠ©åˆ¤æ–·å•é¡Œçš„æ ¹æº
- åŒä¸€å•é¡Œå¤±æ•—ä¸‰æ¬¡å¾Œï¼Œæš«åœã€è¨˜éŒ„ç™¼ç¾ã€ç ”ç©¶æ›¿ä»£æ–¹æ¡ˆã€é‡æ–°è©•ä¼°å‡è¨­å¾Œå†ç¹¼çºŒ
- ä¸å¾—ç¹éå·¥å…·æª¢æŸ¥ (`--no-verify`) æˆ–åœç”¨æ¸¬è©¦
- æŒçºŒåŸ·è¡Œ lint/format/type-check ä¸¦ä¿æŒæ–‡ä»¶æ›´æ–°

## ğŸ› ï¸ **å»ºç½®ã€æ¸¬è©¦èˆ‡é–‹ç™¼æŒ‡ä»¤**

### **Backend (`awesome-mail/`)**
```bash
npm ci                    # å®‰è£ä¾è³´
npm run dev              # é–‹ç™¼ä¼ºæœå™¨
npm run lint             # ç¨‹å¼ç¢¼æª¢æŸ¥
npm run type-check       # å‹åˆ¥æª¢æŸ¥
npm run build            # å»ºç½®
npm run test:coverage    # æ¸¬è©¦è¦†è“‹ç‡
npm run test:ai          # AI æ¸¬è©¦ï¼ˆéœ€æˆæ¬Šæ†‘è­‰ï¼‰
```

### **Flutter (`awesome_mail_flutter/`)**
```bash
flutter pub get          # å®‰è£ä¾è³´
dart run build_runner build --delete-conflicting-outputs  # ç¨‹å¼ç¢¼ç”Ÿæˆ
flutter gen-l10n         # ç”¢ç”Ÿåœ‹éš›åŒ–æª”æ¡ˆ
flutter run              # åŸ·è¡Œæ‡‰ç”¨
flutter test             # åŸ·è¡Œæ¸¬è©¦ï¼ˆä¸ä½¿ç”¨ --coverageï¼Œé¿å… segmentation faultï¼‰
```

**é‡è¦**ï¼š
- âš ï¸ **ä¸è¦ä½¿ç”¨ `flutter test --coverage`**
- Flutter æ¸¬è©¦æ¡†æ¶åœ¨å¤§å‹å°ˆæ¡ˆï¼ˆ500+ æ¸¬è©¦ï¼‰ä½¿ç”¨ `--coverage` æ™‚æœ‰å·²çŸ¥çš„ segmentation fault bug
- ç›¸é—œ issueï¼š[#124145](https://github.com/flutter/flutter/issues/124145), [#128953](https://github.com/flutter/flutter/issues/128953)
- å¦‚æœéœ€è¦ coverageï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š
  ```bash
  # æ–¹æ¡ˆ 1: å–®åŸ·è¡Œç·’åŸ·è¡Œï¼ˆæ…¢ä½†è¼ƒç©©å®šï¼‰
  flutter test --coverage --concurrency=1

  # æ–¹æ¡ˆ 2: åˆ†æ‰¹åŸ·è¡Œæ¸¬è©¦
  flutter test test/unit/data --coverage
  flutter test test/unit/core --coverage
  flutter test test/unit/presentation --coverage
  ```

### **è·¨å°ˆæ¡ˆå›æ­¸æ¸¬è©¦**
```bash
scripts/test-runner.sh   # åŸ·è¡Œå®Œæ•´å›æ­¸æ¸¬è©¦ï¼ˆè¦æ±‚è¦†è“‹ç‡ â‰¥90%ï¼‰
```

## ğŸ“ **ç¨‹å¼ç¢¼é¢¨æ ¼èˆ‡å‘½åè¦ç¯„**

### **Backend (TypeScript)**
- éµå¾ª ESLint + Prettier
- é›™ç©ºæ ¼ç¸®æ’ï¼Œä½¿ç”¨åˆ†è™Ÿ
- ä½¿ç”¨ `const` å„ªå…ˆ
- æª”æ¡ˆå‘½åï¼škebab-case
- æ¸¬è©¦æª”æ¡ˆï¼š`*.test.ts`
- ç¦æ­¢æœªä½¿ç”¨çš„è­˜åˆ¥å­—æˆ–ç„¡ç†ç”±çš„ `any`

### **Flutter (Dart)**
- éµå¾ª `very_good_analysis`
- å–®å¼•è™Ÿï¼Œå°¾éš¨é€—è™Ÿ
- camelCase è­˜åˆ¥å­—
- ç¦æ­¢ä½¿ç”¨ `print`
- æ¶æ§‹åˆ†å±¤ï¼š`core/`, `data/`, `features/`, `presentation/`, `shared/`
- æ“´å±•ç¾æœ‰å…ƒä»¶è€Œéé‡è¤‡å»ºç«‹

## ğŸ§ª **æ¸¬è©¦èˆ‡è¦†è“‹ç‡è¦æ±‚**

### **Backend æ¸¬è©¦æ¨™æº–**
- å–®å…ƒæ¸¬è©¦ï¼š`tests/unit/`ï¼ˆç›®æ¨™ â‰¥90%ï¼‰
- æ•´åˆæ¸¬è©¦ï¼š`tests/integration/`ï¼ˆç›®æ¨™ â‰¥80%ï¼‰
- æ¨¡æ“¬å¤–éƒ¨æœå‹™ï¼ˆé™¤éåŸ·è¡ŒçœŸå¯¦ AI æ¸¬è©¦ï¼‰
- é—œéµæµç¨‹è¦æ±‚ 100% è¦†è“‹ç‡

### **Flutter æ¸¬è©¦æ¨™æº–**
- å–®å…ƒ/Widget æ¸¬è©¦ï¼š`test/`
- ç«¯å°ç«¯æ¸¬è©¦ï¼š`integration_test/`
- æ¸¬è©¦æª”æ¡ˆå‘½åï¼š`feature_action_test.dart`
- ç›®æ¨™è¦†è“‹ç‡ â‰¥90%ï¼ˆæ³¨æ„ï¼šcoverage æ”¶é›†æœ‰å·²çŸ¥ bugï¼Œè¦‹ä¸Šæ–¹èªªæ˜ï¼‰
- ä¿®å¾© bug æ™‚æ–°å¢å›æ­¸æ¸¬è©¦æ¡ˆä¾‹
- **åŸ·è¡Œæ¸¬è©¦æ™‚ä¸ä½¿ç”¨ `--coverage` åƒæ•¸**ï¼ˆé¿å… segmentation faultï¼‰

## ğŸ“¦ **æäº¤èˆ‡ Pull Request è¦ç¯„**

### **Conventional Commits**
- æ ¼å¼ï¼š`<type>(<scope>): <description>`
- ç¯„ä¾‹ï¼š`feat(auth): add oauth refresh`
- ä½¿ç”¨ç¥ˆä½¿å¥ï¼Œscope å°æ‡‰æ¨¡çµ„åç¨±
- é¡å‹ï¼š`feat`, `fix`, `refactor`, `test`, `docs`, `chore`

### **Pull Request è¦æ±‚**
- å¼•ç”¨ç›¸é—œè¦æ ¼/ä»»å‹™ç·¨è™Ÿ
- æè¿°è¡Œç‚ºè®Šæ›´
- é™„ä¸Š lint/test è¼¸å‡ºçµæœ
- UI æ›´æ–°éœ€åŒ…å«æˆªåœ–
- è¨­å®šèª¿æ•´éœ€é™„èªªæ˜ï¼ˆ`wrangler.toml`, OAuth è¨­å®šç­‰ï¼‰

## ğŸ”’ **å®‰å…¨æ€§èˆ‡è¨­å®šæŒ‡å—**

### **æ©Ÿå¯†è³‡è¨Šç®¡ç†**
- çµ•ä¸æäº¤æ©Ÿå¯†è³‡è¨Š
- Worker ç¶å®šå’Œ OAuth é‡‘é‘°é€é Wrangler secrets æˆ–å¹³å°é‡‘é‘°éˆç®¡ç†

### **AI åŠŸèƒ½è¨­å®š**
- é è¨­ä½¿ç”¨ mock endpoints
- åƒ…åœ¨æœ‰æˆæ¬Šæ†‘è­‰æ™‚è¨­å®š `ENABLE_REAL_AI_API_TESTS=true`
- åŸ·è¡ŒçœŸå¯¦ AI æ¸¬è©¦æ™‚éœ€è¨˜éŒ„èªªæ˜

## ğŸ’¬ **æºé€šè¦ç¯„**
- æ‰€æœ‰å›æ‡‰ä½¿ç”¨ç¹é«”ä¸­æ–‡

## ğŸ¯ **é—œéµæŒ‡ä»¤å¿«é€Ÿåƒè€ƒ**
- åŸ·è¡Œä»»å‹™å‰ï¼š`è«‹å…ˆè®€å– .kiro ç›®éŒ„ä¸‹çš„æ‰€æœ‰è¦æ ¼æ–‡ä»¶`
- é–‹å§‹é–‹ç™¼ï¼š`æˆ‘è¦åŸ·è¡Œä»»å‹™ [ä»»å‹™ç·¨è™Ÿ]ï¼Œè«‹å…ˆç¢ºèªéœ€æ±‚å’Œè¨­è¨ˆ`
- å“è³ªæª¢æŸ¥ï¼š`è«‹åŸ·è¡Œå®Œæ•´çš„å“è³ªæª¢æŸ¥æµç¨‹ï¼ŒåŒ…å« lintingã€æ¸¬è©¦å’ŒåŠŸèƒ½é©—è­‰`
